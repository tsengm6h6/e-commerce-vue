(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50aa5260"],{"07ac":function(e,t,r){var a=r("23e7"),n=r("6f53").values;a({target:"Object",stat:!0},{values:function(e){return n(e)}})},"09e9":function(e,t,r){"use strict";r("b001")},"159d":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",{attrs:{direction:"vertical"}},[e.isLoading?r("Loading"):[r("div",{staticClass:"title"},[r("h3",[e._v("訂單列表")]),r("p",[e._v("如有任何問題，請洽專人客服")])]),r("Breadcrumb",{staticClass:"breadcrumb"}),r("el-row",[r("el-col",{attrs:{span:24}},[r("el-table",{staticStyle:{width:"100%"},attrs:{stripe:"",data:e.orders}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("Order",{attrs:{currOrderId:t.row.id},on:{"after-pay-order":e.afterPayOrder}})]}}])}),r("el-table-column",{attrs:{"min-width":"100",label:"日期",prop:"createdAt",align:"center"}}),r("el-table-column",{attrs:{"min-width":"200",label:"訂單編號",prop:"id",align:"center"}}),r("el-table-column",{attrs:{prop:"isPaid",label:"付款狀態","min-width":"100",align:"center",filters:[{text:"已付款",value:!0},{text:"尚未付款",value:!1}],"filter-method":e.filterTag},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tag",{attrs:{size:"small",type:t.row.isPaid?"info":"danger","disable-transitions":""}},[e._v(e._s(t.row.isPaid?"已付款":"尚未付款"))])]}}])}),r("el-table-column",{attrs:{"min-width":"100",label:"總計",prop:"total",align:"center"}}),r("el-table-column",{attrs:{"min-width":"100",label:"訂購人",prop:"userName",align:"center"}})],1),r("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"center"}},[r("el-pagination",{attrs:{"page-count":e.pagination.total_pages,"current-page":e.pagination.current_page,layout:"prev, pager, next"},on:{"update:currentPage":function(t){return e.$set(e.pagination,"current_page",t)},"update:current-page":function(t){return e.$set(e.pagination,"current_page",t)},"current-change":e.handlePageChange}})],1)],1)],1)]],2)},n=[],i=r("5530"),o=r("1da1"),s=(r("96cf"),r("d81d"),r("b0c0"),r("c77f")),c=r("965b"),d=r("ac0d"),u=r("3a5e"),l=r("2fbc"),p={name:"orders",components:{Order:s["a"],Loading:u["a"],Breadcrumb:l["a"]},metaInfo:{title:"我的訂單"},data:function(){return{orders:[],pagination:{},isLoading:!1,currOrderId:""}},mixins:[d["a"]],methods:{fetchOrders:function(){var e=arguments,t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=e.length>0&&void 0!==e[0]?e[0]:1,r.prev=1,t.isLoading=!0,r.next=5,c["a"].getOrders(a);case 5:if(n=r.sent,!0===n.data.success){r.next=8;break}throw new Error;case 8:t.orders=n.data.orders.map((function(e){var r=e.create_at,a=e.id,n=e.is_paid,i=e.num,o=e.total,s=e.user;return{createdAt:t.dateFormat(r),id:a,isPaid:n,num:i,total:o,userName:s?s.name:"-"}})),t.pagination=Object(i["a"])({},n.data.pagination),t.isLoading=!1,r.next=17;break;case 13:r.prev=13,r.t0=r["catch"](1),t.$message.error("無法取得訂單列表，請稍後再試"),t.isLoading=!1;case 17:case"end":return r.stop()}}),r,null,[[1,13]])})))()},handlePageChange:function(e){this.fetchOrders(e),this.$router.push({path:"/orders",query:{page:e}})},filterTag:function(e,t){return t.isPaid===e},afterPayOrder:function(){var e=this.$route.query.page;this.fetchOrders(e)}},created:function(){var e=this.$route.query.page;this.fetchOrders(e)}},m=p,f=(r("bd8d"),r("2877")),g=Object(f["a"])(m,a,n,!1,null,"65b0088e",null);t["default"]=g.exports},"290f":function(e,t,r){},"6f53":function(e,t,r){var a=r("83ab"),n=r("df75"),i=r("fc6a"),o=r("d1e7").f,s=function(e){return function(t){var r,s=i(t),c=n(s),d=c.length,u=0,l=[];while(d>u)r=c[u++],a&&!o.call(s,r)||l.push(e?[r,s[r]]:s[r]);return l}};e.exports={entries:s(!0),values:s(!1)}},ac0d:function(e,t,r){"use strict";r("99af");t["a"]={methods:{dateFormat:function(e){var t=new Date(1e3*e),r=t.getFullYear(),a=(t.getMonth()+1<10?"0":"")+(t.getMonth()+1),n=(t.getDate()<10?"0":"")+t.getDate();return"".concat(r,"-").concat(a,"-").concat(n)}}}},b001:function(e,t,r){},bd8d:function(e,t,r){"use strict";r("290f")},c77f:function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.isLoading?r("Loading"):r("div",[r("el-container",[r("h4",[e._v("訂單編號："+e._s(e.currOrderId))]),!e.orderIsPaid&&e.showPayBtn?r("el-button",{attrs:{type:"warning",size:"small",loading:e.isLoading},on:{click:function(t){return e.payOrder(e.currOrderId)}}},[e._v("確認付款")]):e._e()],1),r("el-divider"),r("p",{staticClass:"title"},[e._v("訂購人資訊")]),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.orderList}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("p",[e._v("信箱："+e._s(t.row.userEmail))]),r("p",[e._v("電話："+e._s(t.row.userTel))]),r("p",[e._v("地址："+e._s(t.row.userAddress))])]}}])}),r("el-table-column",{attrs:{label:"訂購人資訊",prop:"userName","min-width":"180"}}),r("el-table-column",{attrs:{label:"訂購日期",prop:"orderDate","min-width":"100"}}),r("el-table-column",{attrs:{label:"訂單狀態",prop:"isPaid","min-width":"100"}}),r("el-table-column",{attrs:{label:"總金額",prop:"orderSum","min-width":"100"}})],1),r("div",{staticClass:"order-info"},[r("p",{staticClass:"title"},[e._v("訂單明細")]),r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.productsList}},[r("el-table-column",{attrs:{prop:"productName",label:"商品名稱",width:"180"}}),r("el-table-column",{attrs:{prop:"qty",label:"數量","min-width":"50"}}),r("el-table-column",{attrs:{prop:"productUnit",label:"單位","min-width":"50"}}),r("el-table-column",{attrs:{prop:"originPrice",label:"單價","min-width":"100"}}),r("el-table-column",{attrs:{prop:"isCoupon",label:"套用優惠券","min-width":"100"}})],1)],1)],1)},n=[],i=r("1da1"),o=r("5530"),s=(r("96cf"),r("b0c0"),r("d81d"),r("07ac"),r("965b")),c=r("ac0d"),d=r("2f62"),u=r("3a5e"),l={name:"Order",props:{currOrderId:{type:String,require:!0},fromCheckout:{type:Boolean,require:!0}},mixins:[c["a"]],components:{Loading:u["a"]},data:function(){return{orderIsPaid:!1,orderList:[],productsList:[],showPayBtn:!1}},computed:Object(o["a"])({},Object(d["d"])(["isLoading"])),methods:{fetchOrder:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var a,n,i,o,c,d,u,l;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,t.$store.commit("setLoading",!0),r.next=4,s["a"].getOrder(e);case 4:if(a=r.sent,!0===a.data.success){r.next=7;break}throw new Error;case 7:n=a.data.order,i=n.create_at,o=n.id,c=n.is_paid,d=n.products,u=n.total,l=n.user,t.orderIsPaid=c,t.fromCheckout?t.showPayBtn=!1:t.showPayBtn=!c,t.orderList.push({id:o,orderDate:t.dateFormat(i),isPaid:c?"已付款":"尚未付款",orderSum:u,userName:l?l.name:"-",userEmail:l?l.email:"-",userAddress:l?l.address:"-",userTel:l?l.tel:"-"}),t.productsList=Object.values(d).map((function(e){return{isCoupon:e.coupon?"已套用":"",qty:e.qty,originPrice:e.product.price,productName:e.product.title,productUnit:e.product.unit}})),t.$store.commit("setLoading",!1),t.$emit("openDialog"),r.next=20;break;case 16:r.prev=16,r.t0=r["catch"](0),t.$message.error("無法取得訂單，請稍後再試"),t.$store.commit("setLoading",!1);case 20:case"end":return r.stop()}}),r,null,[[0,16]])})))()},payOrder:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,t.$store.commit("setLoading",!0),r.next=4,s["a"].payOrder(e);case 4:if(a=r.sent,!0===a.data.success){r.next=7;break}throw new Error;case 7:t.orderList=t.orderList.map((function(e){return Object(o["a"])(Object(o["a"])({},e),{},{isPaid:"已付款"})})),t.orderIsPaid=!0,t.$store.commit("setLoading",!1),t.$emit("after-pay-order"),r.next=17;break;case 13:r.prev=13,r.t0=r["catch"](0),t.$message.error("無法完成付款，請稍後再試"),t.$store.commit("setLoading",!1);case 17:case"end":return r.stop()}}),r,null,[[0,13]])})))()}},created:function(){this.fetchOrder(this.currOrderId)}},p=l,m=(r("09e9"),r("2877")),f=Object(m["a"])(p,a,n,!1,null,"4363b629",null);t["a"]=f.exports}}]);
//# sourceMappingURL=chunk-50aa5260.b3de30d7.js.map